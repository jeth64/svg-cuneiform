(ns svg-cuneiform.matcher-test
  (:require [clojure.test :refer :all]
            [midje.sweet :refer :all]
            [svg-cuneiform.matcher :refer [flip-curves valid?]]
            ))


;; Note:
;; - "curve with intermediate step" stands for a curve that used to consist of two cubic bezier curves
;;   chained together and were fit to the format of a cubic bezier (by bezier-merge)


(facts "About 'flip-curves'"
 (fact "cases with one curve with an intermediate step can be handled"
       (flip-curves [[[250.583 267.391] [252.187 270.538] [251.937 273.399] [249.833 275.974]]
                     [[251.500 272.725] [252.250 271.892] [253.250 271.892] [254.167 271.975]]
                     [[251.917 270.891] [252.167 271.474] [252.667 271.808] [253.250 271.891]]])
       => [[[250.583 267.391] [252.187 270.538] [251.937 273.399] [249.833 275.974]]
           [[251.500 272.725] [252.250 271.892] [253.250 271.892] [254.167 271.975]]
           [[253.250 271.891] [252.667 271.808] [252.167 271.474] [251.917 270.891]]]))


(facts "About 'valid?'"
 (fact "easy cases can be handled"
       (valid? [[[383.9206 453.3438] [377.5358 452.0050] [373.9573 451.4468] [371.5246 451.3568]]
                [[371.4143 451.4212] [372.3448 450.9542] [372.5938 449.6427] [373.0073 448.3962]]
                [[372.9651 448.7151] [372.9676 450.9701] [375.8151 451.5981] [377.8741 452.3571]]] 2)
       => true
       (valid? [[[354.4084 466.1370] [354.6434 469.3634] [359.0029 470.2110] [361.8044 470.9080]]
                [[365.7508 471.2139] [361.2208 470.3864] [356.7363 469.9219] [352.4348 470.4119]]
                [[352.3244 470.4764] [353.7354 469.5109] [354.1379 467.8319] [354.4234 465.8804]]] 2)
       => true
       (valid? [[[313.7412 415.6631] [315.4417 414.8801] [316.1377 413.3466] [316.5692 411.2061]]
                [[316.5332 411.3232] [316.9202 412.8082] [319.1012 414.4070] [326.6682 415.5992]]
                [[332.0328 415.7047] [325.8158 415.0852] [319.6908 414.8552] [313.8008 415.6377]]] 2)
       => true )
 (fact "cases with one curve with an intermediate step can be handled"
       (valid? [[[250.583 267.391] [252.187 270.538] [251.937 273.399] [249.833 275.974]]
                [[251.500 272.725] [252.250 271.892] [253.250 271.892] [254.167 271.975]]
                [[253.250 271.891] [252.667 271.808] [252.167 271.474] [251.917 270.891]]] 2)
       => true))
